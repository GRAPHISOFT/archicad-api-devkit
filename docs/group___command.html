<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<!-- BEGIN opengraph metadata -->
<meta property="og:title" content="Archicad C++ API" />
<meta property="og:image" content="logo.svg" />
<meta property="og:description" content="Archicad Development Kit Documentation, best practices, example codes and information hub." />
<meta property="og:url" content="https://archicadapi.graphisoft.com/documentation/" />
<!-- END opengraph metadata -->
<!-- BEGIN twitter metadata -->
<meta name="twitter:image:src" content="logo.svg" />
<meta name="twitter:title" content="Archicad C++ API" />
<meta name="twitter:description" content="Archicad Development Kit Documentation, best practices, example codes and information hub." />
<!-- END twitter metadata -->
<title>Archicad 28 C++ API: Command Scopes</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="doxygen-awesome-tabs.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeTabs.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
<link href="https://fonts.cdnfonts.com/css/proxima-nova-2" rel="stylesheet">
<link rel="icon" href="/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#6390f9">
<meta name="msapplication-TileColor" content="#2d89ef">
<meta name="theme-color" content="#ffffff">
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.svg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Archicad 28 C++ API
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('group___command.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">Command Scopes</div></div>
</div><!--header-->
<div class="contents">

<p>Functions related to the Command Scopes of Archicad. They provide a way to post Undoable and NotUndoable commands to the message loop.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_a_c_a_p_i_1_1_modifier_base.html">ACAPI::ModifierBase</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Base class of every Modifier classes used in ExecuteUndoableScope/ExecuteNotUndoableScope/CallDefaultModifier function.  <a href="class_a_c_a_p_i_1_1_modifier_base.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga4bd51a9639b6c0450b21252fb7bfda04"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_a_c_a_p_i_1_1_result.html">ACAPI::Result</a>&lt; void &gt; ARCHICADAPI_EXPORT&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___command.html#ga4bd51a9639b6c0450b21252fb7bfda04">ACAPI::CallUndoableCommand</a> (const std::function&lt; GSErrCode()&gt; &amp;callback, const <a class="el" href="struct_a_p_i___guid.html">API_Token</a> &amp;token, const GS::UniString &amp;undoString)</td></tr>
<tr class="memdesc:ga4bd51a9639b6c0450b21252fb7bfda04"><td class="mdescLeft">&#160;</td><td class="mdescRight">It executes the given callback function in an Undoable scope.  <br /></td></tr>
<tr class="separator:ga4bd51a9639b6c0450b21252fb7bfda04"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae05985a6596bad37bc0c576f623e117d"><td class="memItemLeft" align="right" valign="top">GSErrCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___command.html#gae05985a6596bad37bc0c576f623e117d">ACAPI_Command_GetHttpConnectionPort</a> (UShort *portNumber)</td></tr>
<tr class="memdesc:gae05985a6596bad37bc0c576f623e117d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the HTTP port number, on which Archicad is expecting requests.  <br /></td></tr>
<tr class="separator:gae05985a6596bad37bc0c576f623e117d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab7bf9e1351986b4bb6c69dab76766f1a"><td class="memItemLeft" align="right" valign="top">GSErrCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___command.html#gab7bf9e1351986b4bb6c69dab76766f1a">ACAPI_CallUndoableCommand</a> (const GS::UniString &amp;undoString, const std::function&lt; GSErrCode()&gt; &amp;command)</td></tr>
<tr class="memdesc:gab7bf9e1351986b4bb6c69dab76766f1a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Performs an undoable operation.  <br /></td></tr>
<tr class="separator:gab7bf9e1351986b4bb6c69dab76766f1a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga82422d31ddbfe6425f1371f6ef61fba1"><td class="memItemLeft" align="right" valign="top">GSErrCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___command.html#ga82422d31ddbfe6425f1371f6ef61fba1">ACAPI_CallCommand</a> (const GS::UniString &amp;commandName, const std::function&lt; GSErrCode()&gt; &amp;command)</td></tr>
<tr class="memdesc:ga82422d31ddbfe6425f1371f6ef61fba1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Performs an operation without opening an undoable session.  <br /></td></tr>
<tr class="separator:ga82422d31ddbfe6425f1371f6ef61fba1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Functions related to the Command Scopes of Archicad. They provide a way to post Undoable and NotUndoable commands to the message loop. </p>
<h1><a class="anchor" id="autotoc_md103"></a>
Command Overview</h1>
<p>Archicad uses the <b>command</b> concept to represent and execute a user operation. All data structure modifications (except IO processes) should be performed during command execution. In case of element change notifications, the command is started, executed and managed by Archicad. Add-ons also can start and execute commands.</p>
<p>In case of undoable operations all modifications should be done in a lambda function which is executed by <a class="el" href="group___command.html#gab7bf9e1351986b4bb6c69dab76766f1a">ACAPI_CallUndoableCommand</a>. <br  />
 Undoable commands can be executed only from the main thread. Use <a class="el" href="group___add_on_add_on_communication.html#ga5ff39bd21de9f2e2a905495494a02304">ACAPI_AddOnAddOnCommunication_CallFromEventLoop</a> mechanism to pass the control to the main thread.</p>
<p>There are two possibilities to modify non-undoable data structures:</p>
<ul>
<li>in order to execute several modification functions as a single command, group them with an <a class="el" href="group___command.html#ga82422d31ddbfe6425f1371f6ef61fba1">ACAPI_CallCommand</a> call</li>
<li>call every function as in the past. In this case every command will be treated as a separate command by Archicad, which means that all necessary derived data calculations, screen refresh, etc. will be performed after each function call.</li>
</ul>
<p>Nested command execution is forbidden: you cannot start a new command execution when an existing command is still running.</p>
<p>Complete operations (i.e. opening a plan) cannot be called during command execution, as they may execute several commands themselves.</p>
<p>Because of the command concept, new rules are introduced for API functions. The API functions are divided into four groups:</p>
<ul>
<li><b>Functions that don't modify data structures</b> - there are no special rules for them.</li>
<li><b>Undoable data structure modifier functions (i.e. elem operations)</b> - these functions can only be called during undoable commands (started by Archicad or an add-on)</li>
<li><b>Non-undoable data structure modifier functions (i.e. attributes, environment functions)</b> - these functions can be called from a batch operation using <a class="el" href="group___command.html#ga82422d31ddbfe6425f1371f6ef61fba1">ACAPI_CallCommand</a>, and also can be called standalone.</li>
<li><b>Complete operations</b> - these functions perform complete operations, so they cannot be called neither during undoable operations nor during non-undoable commands. </li>
</ul>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga82422d31ddbfe6425f1371f6ef61fba1" name="ga82422d31ddbfe6425f1371f6ef61fba1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga82422d31ddbfe6425f1371f6ef61fba1">&#9670;&#160;</a></span>ACAPI_CallCommand()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">GSErrCode ACAPI_CallCommand </td>
          <td>(</td>
          <td class="paramtype">const GS::UniString &amp;&#160;</td>
          <td class="paramname"><em>commandName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::function&lt; GSErrCode()&gt; &amp;&#160;</td>
          <td class="paramname"><em>command</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Performs an operation without opening an undoable session. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">commandName</td><td>[in] Reserved for further use, this string won't appear anywhere. </td></tr>
    <tr><td class="paramname">command</td><td>[in] The lambda function (C++11 function wrapper) that encapsulates all the operations. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>NoError - The function has completed with success.</li>
<li>APIERR_REFUSEDCMD - An operation has already opened, or the current command is undoable.</li>
<li>APIERR_COMMANDFAILED - The current command threw an exception. </li>
</ul>
</dd></dl>
<dl class="section remark"><dt>Remarks</dt><dd>This function is used to execute more not-undoable data structure modifier functions in a single command. </dd></dl>

</div>
</div>
<a id="gab7bf9e1351986b4bb6c69dab76766f1a" name="gab7bf9e1351986b4bb6c69dab76766f1a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gab7bf9e1351986b4bb6c69dab76766f1a">&#9670;&#160;</a></span>ACAPI_CallUndoableCommand()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">GSErrCode ACAPI_CallUndoableCommand </td>
          <td>(</td>
          <td class="paramtype">const GS::UniString &amp;&#160;</td>
          <td class="paramname"><em>undoString</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::function&lt; GSErrCode()&gt; &amp;&#160;</td>
          <td class="paramname"><em>command</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Performs an undoable operation. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">undoString</td><td>[in] This string will appear after "Undo " in the Edit menu. Should be localizable. When left empty: "Paste" appears for merging and drag'n'drop operations the name of the command will be shown after "Undo " when the user chooses normal menu driven commands </td></tr>
    <tr><td class="paramname">command</td><td>[in] The lambda function (C++11 function wrapper) that encapsulates the command to be called during the undoable operation. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>NoError - The function has completed with success.</li>
<li>APIERR_UNDOEMPTY - The current action is not undoable.</li>
<li>APIERR_REFUSEDCMD - The current action is not undoable.</li>
<li>APIERR_COMMANDFAILED - The current command threw an exception.</li>
<li>APIERR_NOTMINE - Another add-on has already opened an undoable operation. </li>
</ul>
</dd></dl>
<dl class="section remark"><dt>Remarks</dt><dd>This function encapsulates a (series of) undoable steps (e.g. element creation). All the database modification operations check whether they are performed within an undoable command scope (a database transaction). For some add-on types (e.g. I/O type add-ons) this function doesn't have to be called, as it doesn't make any sense to 'undo' opening a file. Add-ons may not call this function from their element database event handler callback, because those notifications are sent from within an existing database transaction. An add-on can perform more than one undoable command during one call. Just be aware that if the user completes an action in one step, it wouldn't be too convenient for her/him to restore the previous state (perform an "undo") in more than one step. </dd></dl>
<dl class="section user"><dt>Example</dt><dd><div class="fragment"><div class="line">GSErrCode err = <a class="code hl_function" href="group___command.html#gab7bf9e1351986b4bb6c69dab76766f1a">ACAPI_CallUndoableCommand</a> (<span class="stringliteral">&quot;Create text&quot;</span>,</div>
<div class="line">        [&amp;] () -&gt; GSErrCode {</div>
<div class="line">            <span class="keywordflow">return</span> <a class="code hl_function" href="group___element.html#gad4ba2707aac702e651c6b1ec9e212baf">ACAPI_Element_Create</a> (&amp;element, &amp;memo);</div>
<div class="line">        });</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (err != NoError)</div>
<div class="line">        ErrorBeep (<span class="stringliteral">&quot;ACAPI_Element_Create (text)&quot;</span>, err);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="group___element.html#gad24d36ab301120ab689a94743c8fd95a">ACAPI_DisposeElemMemoHdls</a> (&amp;memo);</div>
<div class="ttc" id="agroup___command_html_gab7bf9e1351986b4bb6c69dab76766f1a"><div class="ttname"><a href="group___command.html#gab7bf9e1351986b4bb6c69dab76766f1a">ACAPI_CallUndoableCommand</a></div><div class="ttdeci">GSErrCode ACAPI_CallUndoableCommand(const GS::UniString &amp;undoString, const std::function&lt; GSErrCode()&gt; &amp;command)</div><div class="ttdoc">Performs an undoable operation.</div></div>
<div class="ttc" id="agroup___element_html_gad24d36ab301120ab689a94743c8fd95a"><div class="ttname"><a href="group___element.html#gad24d36ab301120ab689a94743c8fd95a">ACAPI_DisposeElemMemoHdls</a></div><div class="ttdeci">GSErrCode ACAPI_DisposeElemMemoHdls(API_ElementMemo *memo)</div><div class="ttdoc">Frees the memory occupied by all of the allocated memo handles.</div></div>
<div class="ttc" id="agroup___element_html_gad4ba2707aac702e651c6b1ec9e212baf"><div class="ttname"><a href="group___element.html#gad4ba2707aac702e651c6b1ec9e212baf">ACAPI_Element_Create</a></div><div class="ttdeci">GSErrCode ACAPI_Element_Create(API_Element *element, API_ElementMemo *memo)</div><div class="ttdoc">Places a new element into current database.</div></div>
</div><!-- fragment --> </dd></dl>

</div>
</div>
<a id="gae05985a6596bad37bc0c576f623e117d" name="gae05985a6596bad37bc0c576f623e117d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gae05985a6596bad37bc0c576f623e117d">&#9670;&#160;</a></span>ACAPI_Command_GetHttpConnectionPort()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">GSErrCode ACAPI_Command_GetHttpConnectionPort </td>
          <td>(</td>
          <td class="paramtype">UShort *&#160;</td>
          <td class="paramname"><em>portNumber</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns the HTTP port number, on which Archicad is expecting requests. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">portNumber</td><td>[out] HTTP port number. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>NoError - The function has completed with success.</li>
<li>APIERR_BADPARS - the portNumber parameter is nullptr.</li>
<li>APIERR_GENERAL - there is an internal error and the HTTP server could not be started. </li>
</ul>
</dd></dl>
<dl class="section remark"><dt>Remarks</dt><dd>This function is used to get the HTTP port on which the Add-On commands, registered via <code>ACAPI_AddOnAddOnCommunication_InstallAddOnCommandHandler</code>, can be accessed. </dd></dl>

</div>
</div>
<a id="ga4bd51a9639b6c0450b21252fb7bfda04" name="ga4bd51a9639b6c0450b21252fb7bfda04"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga4bd51a9639b6c0450b21252fb7bfda04">&#9670;&#160;</a></span>CallUndoableCommand()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_a_c_a_p_i_1_1_result.html">ACAPI::Result</a>&lt; void &gt; ARCHICADAPI_EXPORT ACAPI::CallUndoableCommand </td>
          <td>(</td>
          <td class="paramtype">const std::function&lt; GSErrCode()&gt; &amp;&#160;</td>
          <td class="paramname"><em>callback</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="struct_a_p_i___guid.html">API_Token</a> &amp;&#160;</td>
          <td class="paramname"><em>token</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const GS::UniString &amp;&#160;</td>
          <td class="paramname"><em>undoString</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>It executes the given callback function in an Undoable scope. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">callback</td><td>The function that will be executed inside the Undoable scope. </td></tr>
    <tr><td class="paramname">token</td><td>The token of the add-on that is calling the command. </td></tr>
    <tr><td class="paramname">undoString</td><td>The string that will be displayed in the Undo/Redo menu.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The return type is ACAPI::Result&lt;void&gt;. </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
</body>
</html>